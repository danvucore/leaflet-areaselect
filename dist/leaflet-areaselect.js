!function(e,t){"function"==typeof define&&define.amd?define(["leaflet"],t):"object"==typeof modules&&module.exports?module.exports=t(require("leaflet")):t(L)}(0,function(c){"use strict";return c.AreaSelect=c.Class.extend({includes:c.Mixin.Events,options:{width:200,height:300,keepAspectRatio:!1},initialize:function(e){c.Util.setOptions(this,e),this._width=this.options.width,this._height=this.options.height},addTo:function(e){return this.map=e,this._createElements(),this._render(),this},getBounds:function(){var e=this.map.getSize(),t=new c.Point,i=new c.Point;i.x=Math.round((e.x-this._width)/2),t.y=Math.round((e.y-this._height)/2),t.x=e.x-i.x,i.y=e.y-t.y;var n=this.map.containerPointToLatLng(i),h=this.map.containerPointToLatLng(t);return new c.LatLngBounds(n,h)},remove:function(){this.map.off("moveend",this._onMapChange),this.map.off("zoomend",this._onMapChange),this.map.off("resize",this._onMapResize),this._container.parentNode.removeChild(this._container)},setDimensions:function(e){e&&(this._height=parseInt(e.height)||this._height,this._width=parseInt(e.width)||this._width,this._render(),this.fire("change"))},_createElements:function(){this._container||(this._container=c.DomUtil.create("div","leaflet-areaselect-container",this.map._controlContainer),this._topShade=c.DomUtil.create("div","leaflet-areaselect-shade leaflet-control",this._container),this._bottomShade=c.DomUtil.create("div","leaflet-areaselect-shade leaflet-control",this._container),this._leftShade=c.DomUtil.create("div","leaflet-areaselect-shade leaflet-control",this._container),this._rightShade=c.DomUtil.create("div","leaflet-areaselect-shade leaflet-control",this._container),this._nwHandle=c.DomUtil.create("div","leaflet-areaselect-handle leaflet-control",this._container),this._swHandle=c.DomUtil.create("div","leaflet-areaselect-handle leaflet-control",this._container),this._neHandle=c.DomUtil.create("div","leaflet-areaselect-handle leaflet-control",this._container),this._seHandle=c.DomUtil.create("div","leaflet-areaselect-handle leaflet-control",this._container),this._setUpHandlerEvents(this._nwHandle),this._setUpHandlerEvents(this._neHandle,-1,1),this._setUpHandlerEvents(this._swHandle,1,-1),this._setUpHandlerEvents(this._seHandle,-1,-1),this.map.on("moveend",this._onMapChange,this),this.map.on("zoomend",this._onMapChange,this),this.map.on("resize",this._onMapResize,this),this.fire("change"))},_setUpHandlerEvents:function(l,r,d){r=r||1,d=d||1;var _=this;c.DomEvent.addListener(l,"mousedown",function i(e){e.stopPropagation(),_.map.dragging.disable(),c.DomEvent.removeListener(this,"mousedown",i);var n=e.pageX,h=e.pageY,a=_._width/_._height,o=_.map.getSize();function s(e){if(_.options.keepAspectRatio){var t=(_._height>=_._width?o.y:o.y*(1/a))-30;_._height+=2*(h-e.originalEvent.pageY)*d,_._height=Math.max(30,_._height),_._height=Math.min(t,_._height),_._width=_._height*a}else _._width+=2*(n-e.originalEvent.pageX)*r,_._height+=2*(h-e.originalEvent.pageY)*d,_._width=Math.max(30,_._width),_._height=Math.max(30,_._height),_._width=Math.min(o.x-30,_._width),_._height=Math.min(o.y-30,_._height);n=e.originalEvent.pageX,h=e.originalEvent.pageY,_._render()}c.DomEvent.addListener(_.map,"mousemove",s),c.DomEvent.addListener(_.map,"mouseup",function e(t){_.map.dragging.enable(),c.DomEvent.removeListener(_.map,"mouseup",e),c.DomEvent.removeListener(_.map,"mousemove",s),c.DomEvent.addListener(l,"mousedown",i),_.fire("change")})})},_onMapResize:function(){this._render()},_onMapChange:function(){this.fire("change")},_render:function(){var e=this.map.getSize(),t=Math.round(this._nwHandle.offsetWidth/2),i=Math.round((e.y-this._height)/2),n=Math.round((e.x-this._width)/2);function h(e,t){e.style.width=t.width+"px",e.style.height=t.height+"px",e.style.top=t.top+"px",e.style.left=t.left+"px",e.style.bottom=t.bottom+"px",e.style.right=t.right+"px"}h(this._topShade,{width:e.x,height:i,top:0,left:0}),h(this._bottomShade,{width:e.x,height:i,bottom:0,left:0}),h(this._leftShade,{width:n,height:e.y-2*i,top:i,left:0}),h(this._rightShade,{width:n,height:e.y-2*i,top:i,right:0}),h(this._nwHandle,{left:n-t,top:i-7}),h(this._neHandle,{right:n-t,top:i-7}),h(this._swHandle,{left:n-t,bottom:i-7}),h(this._seHandle,{right:n-t,bottom:i-7})}}),c.areaSelect=function(e){return new c.AreaSelect(e)},c});